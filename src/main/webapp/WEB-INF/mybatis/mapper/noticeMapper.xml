<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">
	<insert id="insertNotice" parameterType="com.sp.board.Notice">
		INSERT INTO ${tname}notice(noticeNum, subject, content, adminidx)
			VALUES(${tname}notice_seq.NEXTVAL, #{subject}, #{content, jdbcType=VARCHAR}, #{adminIdx})
	</insert>


	<sql id="where-list">
		<choose>
			<when test="searchKey == 'subject'">
				INSTR(subject, #{searchValue}) &gt; 0
			</when>
			<when test="searchKey == 'content'">
				INSTR(content, #{searchValue}) &gt; 0
			</when>
		</choose>
	</sql>
	

	<select id="noticeCount" parameterType="map" resultType="Integer">
		SELECT NVL(count(*),0)
		FROM ${tname}notice
		<where>
			<if test="keyword!=null and keyword!=''">
				<include refid="where-list"/>
			</if>
		</where>
	</select>
	

	<select id="listNotice" parameterType="map" resultType="com.sp.board.Notice">
		SELECT * FROM (
    		SELECT ROWNUM rnum, tb.* FROM (
        		SELECT noticeNum, subject, adminIdx, TO_CHAR(created, 'YYYY-MM-DD') created
        		FROM ${tname}notice
        		<where>
        			<if test="searchValue!=null and searchValue!=''">
						<include refid="where-list"/>
					</if> 
        		</where>
        		ORDER BY noticeNum DESC
     <![CDATA[
    		)tb WHERE rownum <= #{end}
		) where rnum >= #{start}
	]]>
	</select>
	
	<select id="readNotice" parameterType="Integer" resultType="com.sp.board.Notice">
		SELECT noticeNum, subject, content, a.adminIdx, a.adminName, a.adminId, e.created
		FROM ${tname}notice e
		JOIN admin a ON a.adminIdx=e.adminIdx
		WHERE noticeNum=#{noticeNum}
	</select>
</mapper>